using Microsoft.VisualStudio.TestTools.UnitTesting;
using MalwareDetector.BusinessLogic;
using System.IO;

namespace MalwareDetector.Test
{
    [TestClass]
    public class ReportTest
    {
        private readonly static ScanRule[] _scanRules = new[] {
                new ScanRule("JS", "<script>evil_script()</script>", ".js"),
                new ScanRule("rm -rf", @"rm -rf %userprofile%\Documents"),
                new ScanRule("Rundll32", "Rundll32 sus.dll SusEntry")
            };
        private readonly static string _path = Path.Combine(Directory.GetCurrentDirectory(), "../../../TestDirectory");
        private readonly static ScanReport _result = new ScanService(_path, _scanRules).Run();

        [TestMethod]
        public void ReportAmountTest()
        {
            Assert.AreEqual(_result.GetAmount(), 27);
        }
        [TestMethod]
        public void ReportAmountJsTest()
        {
            Assert.AreEqual(_result.GetAmountByRule(_scanRules[0]), 2);
        }
        [TestMethod]
        public void ReportAmountRM_RFTest()
        {
            Assert.AreEqual(_result.GetAmountByRule(_scanRules[1]), 2);
        }
        [TestMethod]
        public void ReportAmountTestRundll32Test()
        {
            Assert.AreEqual(_result.GetAmountByRule(_scanRules[2]), 6);
        }
        [TestMethod]
        public void ReportAmountErrorTest()
        {
            Assert.AreEqual(_result.GetAmountByType(FileReportType.Error), 0);
        }
        [TestMethod]
        public void ReportAmountMalwareTest()
        {
            Assert.AreEqual(_result.GetAmountByType(FileReportType.Malware), 10);
        }
        [TestMethod]
        public void ReportAmountClearTest()
        {
            Assert.AreEqual(_result.GetAmountByType(FileReportType.Clear), 17);
        }
    }
}