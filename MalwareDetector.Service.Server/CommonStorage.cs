using System.Collections.Concurrent;
using System.Linq;
using MalwareDetector.Service.Server.Services;

namespace MalwareDetector.Service.Server
{
    /// <summary>
    /// Глобальные свойства проекта.
    /// Singleton.
    /// </summary>
    public class CommonStorage
    {
        /// <summary>
        /// Список отчетов о текущих процессах.
        /// </summary>
        private readonly ConcurrentBag<ProcessInfo> _processesInfo = new();

        /// <summary>
        /// Настоящий инстанс.
        /// </summary>
        private static CommonStorage _instance;

        /// <summary>
        /// Доступ к инстансу.
        /// </summary>
        public static CommonStorage Instance
        {
            get
            {
                return _instance ??= new CommonStorage();
            }
        }

        /// <summary>
        /// Скрытый конструктор.
        /// </summary>
        private CommonStorage()
        {
        }

        public ProcessInfo GetReportById(string id)
        {
            return _processesInfo.FirstOrDefault(r => r.IdProcess == id);
        }

        public void AddNewProcess(ProcessInfo report)
        {
            _processesInfo.Add(report);
        }
    }
}
